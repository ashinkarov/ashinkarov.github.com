name: Build on Ubuntu
on:
  push:
    branches:
      - source

jobs:
  deploy:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        cabal: ["3.10.1.0"]
        ghc: ["9.2.7"]
    steps:

      - name: Install imagemagick
        run: sudo apt-get install -y imagemagick

      - name: Update stupid imagemagick policy
        run: sudo sed -i_bak 's/rights="none" pattern="PDF"/rights="read | write" pattern="PDF"/' /etc/ImageMagick-6/policy.xml

      - name: Test fucking config
        run: cat /etc/ImageMagick-6/policy.xml

      - name: Checkout site
        uses: actions/checkout@v2

      - name: Try convert
        run: |
          convert --version
          convert -density 80 -flatten ./pubs/2018-ifl-memreuse.pdf[0] x.png
# ########################################################################
# ## INSTALLATION STEP
# ########################################################################
# 
#       - name: Install dependencies
#         uses: haskell/actions/setup@v1
#         with:
#           ghc-version: '${{ matrix.ghc }}'
#           cabal-version: '${{ matrix.cabal }}'
# 
#       - name: Cache ~/.cabal/store and dist-newstyle
#         uses: actions/cache@v2
#         with:
#           path: |
#             ~/.cabal/store
#             ~/dist-newstyle
#           key: ${{ runner.os }}-${{ matrix.ghc }}-${{ matrix.cabal }}
# 
# ########################################################################
# ## BUILD STEP
# ########################################################################
# 
#       # By default github actions do not pull the repo
#       - name: Checkout site
#         uses: actions/checkout@v2
# 
#       - name: Build site
#         run: |
#           cabal build
#           cabal exec artem-blog build
# 
# ########################################################################
# ## DEPLOY STEP
# ########################################################################
# 
#       - name: Deploy HTML
#         uses: JamesIves/github-pages-deploy-action@4.1.3
# 
#         with:
#           branch: master
#           folder: _site
#           git-config-name: Github Actions
